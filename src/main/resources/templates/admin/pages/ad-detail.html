<!DOCTYPE html>
<html lang="fa" dir="rtl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جزئیات آگهی - تاپ کالا</title>
    
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/admin-ad-detail-styles.css" rel="stylesheet">

</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="/images/logo-persia-bazaar-small.png" alt="تاپ کالا" height="100" style="margin-bottom: 10px;">
        </div>
        
        <ul class="sidebar-menu">
            <li>
                <a href="/admin/dashboard" th:href="@{/admin/dashboard}">
                    <i class="fas fa-home"></i>
                    <span>داشبورد</span>
                </a>
            </li>
            <li>
                <a href="/admin/users" th:href="@{/admin/users}">
                    <i class="fas fa-users"></i>
                    <span>کاربران</span>
                </a>
            </li>
            <li>
                <a href="/admin/products" th:href="@{/admin/products}">
                    <i class="fas fa-box"></i>
                    <span>محصولات</span>
                </a>
            </li>
            <li>
                <a href="/admin/ads" th:href="@{/admin/ads}" class="active">
                    <i class="fas fa-bullhorn"></i>
                    <span>آگهی‌ها</span>
                </a>
            </li>
            <li>
                <a href="/admin/settings" th:href="@{/admin/settings}">
                    <i class="fas fa-cog"></i>
                    <span>تنظیمات</span>
                </a>
            </li>
            <li>
                <a href="/admin/logout" th:href="@{/admin/logout}">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>خروج</span>
                </a>
            </li>
        </ul>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="main-content">
        <!-- Top Navbar -->
        <div class="top-navbar">
            <div class="d-flex align-items-center">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="navbar-brand">جزئیات آگهی</div>
            </div>
            
            <div class="navbar-actions">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span>مدیر سیستم</span>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Ad Header Card -->
            <div class="ad-detail-card fade-in">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h2 class="card-title" th:text="${ad.title}">عنوان آگهی</h2>
                            <div class="mt-2">
                                <span th:class="'status-badge status-' + ${ad.status.name().toLowerCase()}"
                                      th:text="${ad.status.name() == 'PENDING' ? 'در انتظار بررسی' :
                                                ad.status.name() == 'APPROVED' ? 'تایید شده' :
                                                ad.status.name() == 'REJECTED' ? 'رد شده' :
                                                ad.status.name() == 'EXPIRED' ? 'منقضی شده' :
                                                'غیرفعال'}">وضعیت</span>
                                <span th:if="${ad.isFeatured}" class="badge bg-warning ms-2">ویژه</span>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button th:if="${ad.status.name() == 'PENDING'}"
                                    class="action-btn btn-approve" 
                                    th:onclick="'approveAd(' + ${ad.id} + ')'">
                                <i class="fas fa-check"></i>
                                تایید
                            </button>
                            <button th:unless="${ad.status.name() == 'REJECTED'}"
                                    class="action-btn btn-reject" 
                                    th:onclick="'rejectAd(' + ${ad.id} + ')'">
                                <i class="fas fa-times"></i>
                                رد
                            </button>
<!--                            <a th:href="@{'/admin/ads/' + ${ad.id} + '/edit'}" class="action-btn btn-edit">-->
<!--                                <i class="fas fa-edit"></i>-->
<!--                                ویرایش-->
<!--                            </a>-->
                            <a href="/admin/ads" class="action-btn btn-back">
                                بازگشت
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Image Gallery -->
                <div class="image-gallery">
                    <img th:each="adImage : ${ad.images}" 
                         th:src="'/uploads/' + ${adImage.image.filename}" 
                         th:alt="'تصویر ' + ${adImage.image.filename}" 
                         class="gallery-image" 
                         data-bs-toggle="modal" 
                         data-bs-target="#imageModal">
                    
                    <!-- Placeholder if no images -->
                    <div th:if="${ad.images == null or ad.images.isEmpty()}" class="no-images-placeholder">
                        <i class="fas fa-image fa-3x text-muted"></i>
                        <p class="text-muted mt-2">هیچ تصویری برای این آگهی ارسال نشده است</p>
                    </div>
                </div>
            </div>

            <!-- Ad Information -->
            <div class="ad-detail-card fade-in">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-info-circle me-2"></i>
                        اطلاعات آگهی
                    </h3>
                </div>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-tag"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-label">دسته‌بندی</div>
                            <div class="info-value" th:text="${ad.category != null ? ad.category.name : 'بدون دسته'}">دسته‌بندی</div>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-label">قیمت</div>
                            <div class="info-value" th:text="${#numbers.formatInteger(ad.price, 0, 'COMMA')} + ' تومان'">قیمت</div>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-label">موقعیت</div>
                            <div class="info-value" th:text="${ad.location != null ? ad.location.city : 'بدون محل'}">موقعیت</div>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-label">تاریخ انتشار</div>
                            <div class="info-value"
                                 th:text="${#temporals.format(ad.createdAt, 'yyyy/MM/dd - HH:mm')}">تاریخ انتشار</div>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-label">تعداد بازدید</div>
                            <div class="info-value" th:text="${ad.viewsCount} + ' بار'">تعداد بازدید</div>
                        </div>
                    </div>

<!--                    <div class="info-item" th:if="${ad.reviewedAt != null}">-->
<!--                        <div class="info-icon">-->
<!--                            <i class="fas fa-clock"></i>-->
<!--                        </div>-->
<!--                        <div class="info-content">-->
<!--                            <div class="info-label">تاریخ بررسی</div>-->
<!--                            <div class="info-value"-->
<!--                                 th:text="${#temporals.format(ad.reviewedAt, 'yyyy/MM/dd - HH:mm')}">تاریخ بررسی</div>-->
<!--                        </div>-->
<!--                    </div>-->
                </div>
                
                <div class="mt-4">
                    <h5><i class="fas fa-align-right me-2"></i>توضیحات</h5>
                    <p class="text-muted" th:text="${ad.description}">توضیحات آگهی</p>
                </div>
                
                <div class="mt-4" th:if="${ad.rejectionReason != null and !ad.rejectionReason.isEmpty()}">
                    <h5 class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>دلیل رد</h5>
                    <p class="text-danger" th:text="${ad.rejectionReason}">دلیل رد آگهی</p>
                </div>
            </div>

            <!-- Advertiser Information -->
            <div class="ad-detail-card fade-in">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-user me-2"></i>
                        اطلاعات آگهی‌دهنده
                    </h3>
                </div>
                
                <div class="user-profile">
                    <div class="user-avatar-large">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h5 th:text="${ad.user.firstName + ' ' + ad.user.lastName}">نام کاربر</h5>
                        <p><i class="fas fa-phone me-2"></i><span th:text="${ad.user.phoneNumber}">شماره تلفن</span></p>
                        <p><i class="fas fa-envelope me-2"></i><span th:text="${ad.user.email}">ایمیل</span></p>
                        <p><i class="fas fa-calendar me-2"></i>عضو از: <span th:text="${#temporals.format(ad.user.createdAt, 'yyyy/MM/dd')}">تاریخ عضویت</span></p>
                    </div>
                </div>
                

            </div>

        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">تصویر آگهی</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img src="https://via.placeholder.com/800x600" alt="تصویر آگهی" class="img-fluid">
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Sidebar Toggle
        document.getElementById('sidebar-toggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            if (window.innerWidth > 768) {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            } else {
                sidebar.classList.toggle('show');
            }
        });

        // Close sidebar on mobile when clicking outside
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const toggle = document.getElementById('sidebar-toggle');
                
                if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
                    sidebar.classList.remove('show');
                }
            }
        });

        // Action functions
        function approveAd(id) {
            if (confirm('آیا از تایید این آگهی اطمینان دارید؟')) {
                window.location.href = `/admin/ads/${id}/approve`;
            }
        }

        function rejectAd(id) {
            const reason = prompt('دلیل رد آگهی را وارد کنید:');
            if (reason) {
                window.location.href = `/admin/ads/${id}/reject?reason=${encodeURIComponent(reason)}`;
            }
        }

        // Image modal functionality
        document.querySelectorAll('.gallery-image').forEach(img => {
            img.addEventListener('click', function() {
                document.querySelector('#imageModal .modal-body img').src = this.src;
            });
        });
    </script>
</body>
</html>
