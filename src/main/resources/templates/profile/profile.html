<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Iran ECommerce</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Universal Styles -->
    <link href="/css/universal-styles.css" rel="stylesheet">
    <link href="/css/profile-styles.css" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="/images/logo-online-store-small.png" alt="فروشگاه اینترنتی" height="100">
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/ads">Ads</a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i>
                            <span th:text="${user.firstName + ' ' + user.lastName}">کاربر</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/profile"><i class="bi bi-person me-2"></i>My Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form method="post" action="/logout" class="d-inline">
                                    <button type="submit" class="dropdown-item text-danger">
                                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Profile Sidebar -->
            <div class="col-lg-3">
                <div class="profile-sidebar">
                    <!-- Avatar and Info -->
                    <div class="profile-avatar">
                        <span th:text="${user.firstName?.substring(0,1)}">ک</span>
                    </div>
                    
                    <div class="profile-info">
                        <h4 class="profile-name" th:text="${user.firstName + ' ' + user.lastName}">User Name</h4>
                        <p class="profile-username" th:text="'@' + ${user.username}">@username</p>
                    </div>
                    
                    <!-- Stats -->
                    <div class="stats-badges">
                        <span class="stat-badge">
                            <span th:text="${userAdsCount}">0</span> Ads
                        </span>
                        <span class="stat-badge">
                            <span th:text="${activeAdsCount}">0</span> Active
                        </span>
                    </div>
                    
                    <!-- Social Media Links -->
                    <div class="social-links" th:if="${user.linkdin != null or user.facebook != null or user.instagram != null or user.whatsapp != null or user.telegram != null}">
                        <div class="social-links-title">
                            <small class="text-muted">Follow me:</small>
                        </div>
                        <div class="social-icons">
                            <a th:if="${user.linkdin != null and user.linkdin != ''}" 
                               th:href="${user.linkdin}" 
                               target="_blank" 
                               class="social-icon linkedin"
                               title="LinkedIn">
                                <i class="bi bi-linkedin"></i>
                            </a>
                            <a th:if="${user.facebook != null and user.facebook != ''}" 
                               th:href="${user.facebook}" 
                               target="_blank" 
                               class="social-icon facebook"
                               title="Facebook">
                                <i class="bi bi-facebook"></i>
                            </a>
                            <a th:if="${user.instagram != null and user.instagram != ''}" 
                               th:href="${user.instagram}" 
                               target="_blank" 
                               class="social-icon instagram"
                               title="Instagram">
                                <i class="bi bi-instagram"></i>
                            </a>
                            <a th:if="${user.whatsapp != null and user.whatsapp != ''}" 
                               th:href="${user.whatsapp}" 
                               target="_blank" 
                               class="social-icon whatsapp"
                               title="WhatsApp">
                                <i class="bi bi-whatsapp"></i>
                            </a>
                            <a th:if="${user.telegram != null and user.telegram != ''}" 
                               th:href="${user.telegram}" 
                               target="_blank" 
                               class="social-icon telegram"
                               title="Telegram">
                                <i class="bi bi-telegram"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Menu -->
                    <ul class="profile-menu">
                        <li>
                            <a href="/profile" th:class="${currentPath == '/profile'} ? 'active' : ''">
                                <i class="bi bi-house-door"></i>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="/profile/ads" th:class="${currentPath == '/profile/ads'} ? 'active' : ''">
                                <i class="bi bi-megaphone"></i>
                                My Ads
                            </a>
                        </li>
                        <li>
                            <a href="/profile/favorites" th:class="${currentPath == '/profile/favorites'} ? 'active' : ''">
                                <i class="bi bi-heart"></i>
                                Favorite Ads
                            </a>
                        </li>
                        <li>
                            <a href="/ads/create" th:class="${currentPath == '/ads/create'} ? 'active' : ''">
                                <i class="bi bi-plus-circle"></i>
                                Post New Ad
                            </a>
                        </li>
                        <li>
                            <a href="/profile/messages" th:class="${currentPath == '/profile/messages'} ? 'active' : ''">
                                <i class="bi bi-chat-dots"></i>
                                Messages
                                <span class="badge bg-danger ms-auto">New</span>
                            </a>
                        </li>
                        <li>
                            <a href="/profile/edit" th:class="${currentPath == '/profile/edit'} ? 'active' : ''">
                                <i class="bi bi-gear"></i>
                                Edit Profile
                            </a>
                        </li>
                        <li>
                            <a href="/profile/change-password" th:class="${currentPath == '/profile/change-password'} ? 'active text-warning' : 'text-warning'">
                                <i class="bi bi-shield-lock"></i>
                                Change Password
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Search Section -->
                <div class="search-container">
                    <form th:action="@{/profile}" method="get" class="d-flex align-items-center">
                        <input type="text" 
                               class="search-input" 
                               name="search"
                               th:value="${search}"
                               placeholder="Search in ads...">
                        <button type="submit" class="search-btn">
                            <i class="bi bi-search"></i>
                        </button>
                    </form>
                </div>

                <!-- Results Info -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h5 class="mb-0">
                            <span th:if="${search != null and search != ''}" th:text="'Search results for: ' + ${search}">Search results</span>
                            <span th:if="${search == null or search == ''}">Latest Ads</span>
                        </h5>
                        <small class="text-muted">
                            <span th:text="${latestAds.totalElements}">0</span> ads found
                        </small>
                    </div>
                </div>

                <!-- Ads Grid -->
                <div class="row ads-grid" th:if="${latestAds != null and !latestAds.empty}">
                    <div class="col-md-6 col-xl-4" th:each="ad : ${latestAds}">
                        <div class="ad-card" th:onclick="'viewAd(' + ${ad.id} + ')'">
                            <img th:src="${ad.images != null and !ad.images.empty ? ad.images[0].image.url : '/images/no-image.svg'}"
                                 class="ad-image"
                                 th:alt="${ad.title}">
                            <div class="ad-card-body">
                                <h6 class="ad-title" th:text="${ad.title}">Ad Title</h6>
                                <div class="ad-price" th:text="${#numbers.formatInteger(ad.price, 0, 'COMMA')} + ' $'">Price</div>
                                <div class="ad-location">
                                    <i class="bi bi-geo-alt"></i>
                                    <span th:text="${ad.location != null ? ad.location.city : 'Unknown'}">Location</span>
                                </div>
                                <div class="ad-time">
                                    <i class="bi bi-clock"></i>
                                    <span th:text="${#temporals.format(ad.createdAt, 'yyyy/MM/dd')}">Date</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Results -->
                <div class="no-ads" th:if="${latestAds == null or latestAds.empty}">
                    <i class="bi bi-search" style="font-size: 3rem; color: #ddd;"></i>
                    <h4 class="mt-3">No ads found</h4>
                    <p>Please try changing your search term</p>
                </div>

                <!-- Pagination -->
                <div class="pagination-container" th:if="${totalPages > 1}">
                    <nav>
                        <ul class="pagination">
                            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                <a class="page-link" th:href="@{/profile(page=${currentPage - 1}, search=${search})}">
                                    Previous
                                </a>
                            </li>
                            
                            <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}" 
                                th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}"
                                th:classappend="${pageNum == currentPage} ? 'active'">
                                <a class="page-link" th:href="@{/profile(page=${pageNum}, search=${search})}" 
                                   th:text="${pageNum + 1}">1</a>
                            </li>
                            
                            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                                <a class="page-link" th:href="@{/profile(page=${currentPage + 1}, search=${search})}">
                                    Next
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function viewAd(id) {
            window.location.href = '/ads/' + id;
        }
    </script>
</body>
</html>
