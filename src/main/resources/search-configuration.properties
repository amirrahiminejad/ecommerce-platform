# Search Configuration for Iran ECommerce

# ====================================
# BASIC SEARCH SETTINGS
# ====================================

# Search functionality
app.search.enabled=true
app.search.max-page-size=100
app.search.max-total-results=10000
app.search.max-keyword-length=200
app.search.min-keyword-length=2
app.search.max-suggestions=10

# Performance settings
app.search.performance.search-timeout-ms=30000
app.search.performance.parallel-threads=4
app.search.performance.use-connection-pooling=true
app.search.performance.max-connections=20

# Relevance scoring weights
app.search.scoring.title-weight=2.0
app.search.scoring.description-weight=1.0
app.search.scoring.date-weight=0.5
app.search.scoring.popularity-weight=0.3
app.search.scoring.price-weight=0.2

# ====================================
# CACHING CONFIGURATION
# ====================================

# Search result caching
app.search.cache-enabled=true
app.search.cache-expiration-seconds=3600

# Redis configuration for search caching (if using Redis)
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=
spring.redis.database=1
spring.redis.timeout=2000ms

# Cache names and TTL
spring.cache.cache-names=search-results,search-suggestions,popular-categories
spring.cache.redis.time-to-live=3600000

# ====================================
# LOGGING CONFIGURATION  
# ====================================

# Search logging
app.search.search-logging-enabled=true

# Specific logging levels for search module
logging.level.com.webrayan.store.modules.search=INFO
logging.level.com.webrayan.store.modules.search.service=DEBUG
logging.level.com.webrayan.store.modules.search.repository=DEBUG

# SQL logging for development (disable in production)
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ====================================
# DATABASE CONFIGURATION
# ====================================

# PostgreSQL specific settings for full-text search
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Connection pool settings for search load
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000

# ====================================
# ELASTICSEARCH CONFIGURATION (FUTURE)
# ====================================

# Elasticsearch settings (disabled by default)
app.elasticsearch.enabled=false
app.elasticsearch.host=localhost
app.elasticsearch.port=9200
app.elasticsearch.username=
app.elasticsearch.password=
app.elasticsearch.use-https=false

# Index settings
app.elasticsearch.index.prefix=online_store
app.elasticsearch.index.ads-index=ads
app.elasticsearch.index.products-index=products
app.elasticsearch.index.number-of-shards=1
app.elasticsearch.index.number-of-replicas=1

# Analyzer settings
app.elasticsearch.index.analyzer.default-analyzer=standard
app.elasticsearch.index.analyzer.search-analyzer=standard
app.elasticsearch.index.analyzer.language=english

# ====================================
# MONITORING AND METRICS
# ====================================

# Actuator endpoints for monitoring
management.endpoints.web.exposure.include=health,metrics,prometheus
management.endpoint.health.show-details=always
management.metrics.export.prometheus.enabled=true

# Custom metrics for search
management.metrics.tags.application=online-store
management.metrics.tags.module=search

# ====================================
# SECURITY SETTINGS
# ====================================

# Search API rate limiting (requests per minute)
app.search.rate-limit.enabled=true
app.search.rate-limit.requests-per-minute=100
app.search.rate-limit.burst-capacity=20

# Input validation
app.search.validation.max-keyword-length=200
app.search.validation.allowed-sort-fields=RELEVANCE,PRICE_ASC,PRICE_DESC,DATE_ASC,DATE_DESC,POPULARITY,SALES,NAME_ASC,NAME_DESC
app.search.validation.allowed-accuracy-levels=EXACT,PARTIAL,FUZZY

# ====================================
# ASYNC PROCESSING
# ====================================

# Thread pool for async search operations
app.search.async.core-pool-size=4
app.search.async.max-pool-size=8
app.search.async.queue-capacity=100
app.search.async.thread-name-prefix=search-async-

# ====================================
# DEVELOPMENT/PRODUCTION PROFILES
# ====================================

# Development settings
---
spring.profiles: development

# More verbose logging in development
logging.level.com.webrayan.store.modules.search=DEBUG
logging.level.org.springframework.cache=DEBUG

# Smaller cache TTL for development
app.search.cache-expiration-seconds=300

# Elasticsearch in development (if available)
app.elasticsearch.enabled=false

---
spring.profiles: production

# Production logging
logging.level.com.webrayan.store.modules.search=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Longer cache TTL in production
app.search.cache-expiration-seconds=7200

# Production database pool settings
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10

# Rate limiting in production
app.search.rate-limit.requests-per-minute=60

---
spring.profiles: elasticsearch

# Elasticsearch enabled profile
app.elasticsearch.enabled=true
app.search.engine=elasticsearch

# Use Elasticsearch instead of database search
app.search.use-database-fallback=true

---
spring.profiles: test

# Test-specific settings
app.search.cache-enabled=false
app.search.search-logging-enabled=false

# Faster timeouts for tests
app.search.performance.search-timeout-ms=5000

# In-memory database for tests
spring.datasource.url=jdbc:h2:mem:testdb
spring.jpa.hibernate.ddl-auto=create-drop
