# مدیریت تنظیمات سیستم

## مقدمه
صفحه مدیریت تنظیمات امکان تنظیم و پیکربندی کلی سیستم فروشگاه اینترنتی را فراهم می‌کند. این صفحه به مدیران امکان تغییر تنظیمات اساسی مانند نام سایت، ایمیل مدیریت، حالت تعمیرات و سایر پارامترهای سیستم را می‌دهد.

## دسترسی به صفحه تنظیمات
- **URL:** `/admin/settings`
- **سطح دسترسی:** فقط مدیران سیستم
- **مسیر در منوی ادمین:** داشبورد > تنظیمات

## ویژگی‌های صفحه

### 1. نمایش تنظیمات فعلی
- نمایش تمام تنظیمات سیستم در قالب جدول تعاملی
- نمایش کلید، مقدار و توضیحات هر تنظیمات
- پشتیبانی از انواع مختلف input بر اساس نوع تنظیمات

### 2. انواع تنظیمات

#### تنظیمات اصلی سایت
- **site_name:** نام فروشگاه که در سراسر سایت نمایش داده می‌شود
- **site_title:** عنوان سایت برای SEO و تب مرورگر
- **site_description:** توضیحات سایت برای متا تگ‌ها و SEO

#### تنظیمات منطقه‌ای
- **default_currency:** واحد پولی پیش‌فرض (مثال: تومان، ریال، دلار)
- **default_language:** زبان پیش‌فرض سایت (fa برای فارسی)

#### تنظیمات تماس
- **admin_email:** آدرس ایمیل مدیر سیستم برای دریافت اعلان‌ها
- **support_phone:** شماره تلفن پشتیبانی مشتریان

#### تنظیمات فنی
- **max_upload_size:** حداکثر اندازه فایل قابل آپلود (به بایت)
- **items_per_page:** تعداد آیتم‌ها در هر صفحه لیست‌ها
- **maintenance_mode:** حالت تعمیرات سایت (فعال/غیرفعال)

## عملیات قابل انجام

### 1. ویرایش تنظیمات
1. مقدار مورد نظر را در فیلد مربوطه تغییر دهید
2. دکمه "ذخیره تغییرات" را کلیک کنید
3. پیام تأیید نمایش داده می‌شود

### 2. افزودن تنظیمات جدید
1. دکمه "افزودن تنظیمات" را کلیک کنید
2. کلید تنظیمات را وارد کنید (باید منحصر به فرد باشد)
3. مقدار تنظیمات را وارد کنید
4. "افزودن" را کلیک کنید

### 3. حذف تنظیمات
1. آیکون سطل زباله در سطر مورد نظر را کلیک کنید
2. حذف را تأیید کنید

### 4. بازگردانی به حالت پیش‌فرض
1. دکمه "بازگردانی پیش‌فرض" را کلیک کنید
2. عملیات را تأیید کنید (این عمل غیرقابل بازگشت است)

## انواع Input بر اساس تنظیمات

### Text Input
- تنظیمات عمومی مثل نام سایت، عنوان، تلفن

### Email Input
- ایمیل مدیر با اعتبارسنجی خودکار

### Number Input
- تنظیمات عددی مثل حداکثر اندازه آپلود، تعداد در صفحه

### Textarea
- تنظیمات متنی طولانی مثل توضیحات سایت

### Select Dropdown
- تنظیمات با گزینه‌های محدود مثل حالت تعمیرات (فعال/غیرفعال)

## پیام‌های سیستم

### پیام‌های موفقیت
- "تنظیمات با موفقیت بروزرسانی شد"
- "تنظیمات جدید با موفقیت اضافه شد"
- "تنظیمات با موفقیت حذف شد"
- "تنظیمات با موفقیت به حالت پیش‌فرض بازگردانده شد"

### پیام‌های خطا
- "خطا در بروزرسانی تنظیمات"
- "کلید تنظیمات قبلاً موجود است"
- "تنظیمات یافت نشد"
- "خطا در حذف تنظیمات"

## نکات امنیتی

### محدودیت دسترسی
- فقط کاربران با نقش مدیر سیستم امکان دسترسی دارند
- تمام عملیات در لاگ سیستم ثبت می‌شود

### اعتبارسنجی
- کلیدهای تنظیمات باید منحصر به فرد باشند
- اعتبارسنجی ایمیل برای فیلدهای ایمیل
- اعتبارسنجی عدد برای فیلدهای عددی

## ساختار فنی

### Controller
```java
@Controller
@RequestMapping("/admin/settings")
public class AdminSettingController {
    // مدیریت تمام عملیات CRUD تنظیمات
}
```

### Repository
```java
public interface SettingRepository extends JpaRepository<Setting, Long> {
    Optional<Setting> findByKey(String key);
    boolean existsByKey(String key);
}
```

### Entity
```java
@Entity
@Table(name = "settings")
public class Setting {
    private String key;     // کلید تنظیمات
    private String value;   // مقدار تنظیمات
    private User user;      // null برای تنظیمات سیستمی
}
```

## تنظیمات پیش‌فرض سیستم

هنگام نصب اولیه سیستم، تنظیمات زیر به صورت خودکار ایجاد می‌شوند:

| کلید | مقدار پیش‌فرض | توضیحات |
|------|--------------|---------|
| site_name | فروشگاه اینترنتی | نام سایت |
| site_title | فروشگاه آنلاین | عنوان سایت |
| site_description | فروشگاه اینترنتی با محصولات متنوع | توضیحات سایت |
| default_currency | تومان | واحد پول |
| default_language | fa | زبان پیش‌فرض |
| admin_email | admin@online-store.com | ایمیل مدیر |
| support_phone | +98-21-12345678 | تلفن پشتیبانی |
| max_upload_size | 10485760 | حداکثر آپلود (10MB) |
| items_per_page | 20 | تعداد در صفحه |
| maintenance_mode | false | حالت تعمیرات |

## نکات مهم

### حالت تعمیرات
- فعال‌سازی حالت تعمیرات سایت را برای کاربران عادی غیرقابل دسترس می‌کند
- مدیران همچنان امکان دسترسی دارند
- پیام مناسب به کاربران نمایش داده می‌شود

### حداکثر اندازه آپلود
- مقدار بر حسب بایت وارد شود
- 1MB = 1048576 بایت
- 10MB = 10485760 بایت

### بک‌آپ
- پیش از تغییرات مهم، از تنظیمات بک‌آپ تهیه کنید
- عملیات بازگردانی پیش‌فرض غیرقابل بازگشت است

## عیب‌یابی مشکلات رایج

### مشکل: تنظیمات ذخیره نمی‌شود
**علت احتمالی:** مشکل در اتصال دیتابیس یا خطای validation
**راه حل:** بررسی لاگ‌های سیستم و اطمینان از صحت داده‌های ورودی

### مشکل: صفحه بارگیری نمی‌شود
**علت احتمالی:** عدم دسترسی کاربر یا مشکل در سرور
**راه حل:** بررسی سطح دسترسی کاربر و وضعیت سرور

### مشکل: تنظیمات پیش‌فرض نمایش داده نمی‌شود
**علت احتمالی:** مشکل در اجرای CommonDataInitializer
**راه حل:** اجرای مجدد فرآیند initialize یا وارد کردن دستی

## پشتیبانی و بروزرسانی
برای مشکلات فنی و پیشنهادات بهبود، با تیم توسعه تماس بگیرید.

---

**آخرین بروزرسانی:** اکتبر ۲۰۲۵  
**نسخه:** ۱.۰.۰
